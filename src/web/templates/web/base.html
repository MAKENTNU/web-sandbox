{% load static %}
{% load i18n %}
{% load hosts %}
{% load uri_tags %}


<!DOCTYPE html>
<html lang="{{ CURRENT_LANGUAGE_CODE }}">
<head>
    <title>{% block title_full %}{% block title %}{{ page_title }}{% endblock title %} | MAKE NTNU{% endblock title_full %}</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width"/>
    {% block favicon_template %}
        {% include 'web/favicon.html' with favicons_folder='web/img/favicons' %}
    {% endblock favicon_template %}

    {% block open_graph_meta %}
        <meta property="og:title" content="{% block og_title %}MAKE NTNU{% endblock og_title %}"/>
        <meta property="og:site_name" content="MAKE NTNU"/>
        <meta property="og:image" content="{% spaceless %}
            {% block og_image_absolute_uri %}
                {% static 'web/img/logo_og_thumbnail.png' as og_image_url %}
                {% get_absolute_uri_for_path request og_image_url %}
            {% endblock og_image_absolute_uri %}
        {% endspaceless %}"/>
        <meta property="og:image:alt" content="{% block og_image_alt %}{% translate "MAKE NTNU's logo" %}{% endblock og_image_alt %}"/>
        {% translate "MAKE NTNU is a voluntary student organization that works for a better environment for project development, both in private and educational contexts, for all students and employees at NTNU." as site_description %}
        <meta property="og:description" content="{% block og_description %}{{ site_description }}{% endblock og_description %}"/>
        <meta property="description" content="{% block description %}{{ site_description }}{% endblock description %}"/>
        <meta property="og:type" content="{% block og_type %}website{% endblock og_type %}"/>
        <meta property="og:url" content="{% get_absolute_uri_no_query request %}"/>
    {% endblock open_graph_meta %}

    <link rel="stylesheet" href="{% static 'web/css/font_faces.css' %}"/>
    <link rel="stylesheet" href="{% static 'lib/fomantic-ui/semantic.min.css' %}"/>
    <link rel="stylesheet" href="{% static 'web/css/style.css' %}"/>
    <script src="{% host_url 'javascript_catalog' host 'main' %}"></script>
    <script src="{% static 'lib/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'lib/jquery/jquery.dirty.js' %}"></script>
    <script src="{% static 'lib/fomantic-ui/semantic.min.js' %}"></script>
    <script src="{% static 'fomantic-ui/settings.js' %}"></script>
    <script>
        const LANG_PREFIX = {% if CURRENT_LANGUAGE_CODE == DEFAULT_LANGUAGE_CODE %} "" {% else %} "/{{ CURRENT_LANGUAGE_CODE }}" {% endif %};
    </script>
    {# Temporary fix for CKEditor not being able to find its static files (see https://django-ckeditor.readthedocs.io/en/latest/#required) #}
    <script>window.CKEDITOR_BASEPATH = '/static/ckeditor/ckeditor/';</script>

    <script defer src="{% static 'web/js/base.js' %}"></script>

    {% block analytics %}
        <script defer src="https://www.googletagmanager.com/gtag/js?id=G-7KWS6X84KG"></script>
        <script defer src="{% static 'web/js/gtag_init.js' %}"></script>
    {% endblock analytics %}

    {% block header_links %}
        <link rel="stylesheet" href="{% static 'web/css/header.css' %}"/>
        <link rel="stylesheet" href="{% static 'announcements/css/announcement_banner.css' %}"/>
        <script defer src="{% static 'web/js/header.js' %}"></script>
    {% endblock header_links %}

    {# `common_utils.js` should not be deferred, as it only contains function definitions #}
    <script src="{% static 'web/js/common_utils.js' %}"></script>
    <script defer src="{% static 'web/js/common_deferred_code.js' %}"></script>
    <script defer src="{% static 'web/js/delete_modal.js' %}"></script>

    {# Should be kept at the bottom of `<head>`, so that deferred form media scripts are loaded after the scripts linked above #}
    {% block extra_head %}{% endblock extra_head %}
</head>
<body>

{# Should always be the first child of `<body>` #}
<a class="skip-to-main-content" href="">
    {% translate "Skip to main content" %}
</a>

<div class="wrapper">
    <div class="content">
        {% block header %}
            {% include 'web/header.html' %}
        {% endblock header %}

        {% block padding_top %}
            <div class="make-content-padding"></div>
        {% endblock padding_top %}

        <main id="main">
            {% block body %}
            {% endblock body %}
        </main>

        {% block padding_bottom %}
            <div class="make-content-padding"></div>
        {% endblock padding_bottom %}
    </div>

    {% include 'web/delete_modal.html' %}
    {% block footer %}
        {% include 'web/footer.html' %}
    {% endblock footer %}
</div>

<script>
    async function releaseSpagets() {
        const spagets = [
            "{% static 'web/img/spaget/1.jpg' %}",
            "{% static 'web/img/spaget/2.jpg' %}",
            "{% static 'web/img/spaget/3.jpg' %}",
            "{% static 'web/img/spaget/4.jpg' %}",
            "{% static 'web/img/spaget/5.jpg' %}",
            "{% static 'web/img/spaget/6.jpg' %}",
            "{% static 'web/img/spaget/7.jpg' %}",
            "{% static 'web/img/spaget/8.jpg' %}",
            "{% static 'web/img/spaget/9.jpg' %}",
            "{% static 'web/img/spaget/10.jpg' %}",
            "{% static 'web/img/spaget/11.jpg' %}",
            "{% static 'web/img/spaget/12.jpg' %}",
        ];

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min) + min); // The maximum is exclusive and the minimum is inclusive
        }

        await sleep(3000);
        const $body = $("body");
        const maxWidth = 0.25;
        const maxHeight = 0.25;
        const maxX = (1 - maxWidth) * window.innerWidth;
        const maxY = (1 - maxHeight) * window.innerHeight;
        let i = getRandomInt(0, spagets.length);
        while (true) {
            i++;
            const index = i % spagets.length;
            const x = getRandomInt(0, maxX);
            const y = getRandomInt(0, maxY);
            const $spaget = $(
                    `<img class="spaget" src="${spagets[index]}"
                          style="position: fixed;
                                 left: ${x}px;
                                 top: ${y}px;
                                 rotate: ${Math.random() * 360}deg;
                                 z-index: ${1001 + i};
                                 max-width: ${maxWidth * 100}vw;
                                 max-height: ${maxHeight * 100}vh;"
                          onclick="$(this).remove();"/>`,
            );
            $body.prepend($spaget);
            await sleep(10000);
        }
    }

    if (window.location.pathname.startsWith("/reservation"))
        releaseSpagets();
</script>

</body>
</html>
